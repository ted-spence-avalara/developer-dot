---
layout: page
title: 11.1 - Understanding and Managing Result/Error Messages
product: avaTax
doctype: dev_guide
chapter: calculating-tax-offline
nav: apis
disqus: 1
---

<ul class="pager">
  <li class="previous"><a href="/avatax/dev-guide/calculating-tax-offline/"><i class="glyphicon glyphicon-chevron-left"></i>Previous</a></li>
  <li class="next"><a href="/avatax/dev-guide/calculating-tax-offline/performance-tuning-and-management/">Next<i class="glyphicon glyphicon-chevron-right"></i></a></li>
</ul>

Understanding and taking appropriate action on error messages is critical to the successful implementation of a custom connector. The errors and warnings that result from web service calls will guide the receiver to the most logical problem resolution path.

If a call fails, the receiver should always iterate through the messages collection that will be part of the result set and check the contents of the Name, Summary, Details and RefersTo fields of each message. Often the contents of these messages will indicate what the problem is.

Let's breakdown an example error message.  John has processed a <code>SalesOrder</code> and is receiving an error message stating:  <code>DocumentNotFoundError: The tax document could not be found</code>.

The message may appear within the response xml data as the following:
<pre>
{
    "error": {
        "code": "EntityNotFoundError",
        "message": "Document with ID 'TESTINGCO - 100' not found.",
        "target": "HttpRequest",
        "details": [
            {
                "code": "EntityNotFoundError",
                "number": 4,
                "message": "Document with ID 'TESTINGCO - 100' not found.",
                "faultCode": "Client",
                "helpLink": "http://developer.avalara.com/avatax/errors/EntityNotFoundError",
                "severity": "Error"
            }
        ]
    }
}
</pre>

While rare, consideration should be given to critical errors that can occur that are not as straight-forward.  For example, if encountering an error stating:  "The server was unable to process the request due to an internal error," the messaging provided may seem cryptic in the details of the error. To gain more information about the error, either turn on <code>IncludeExceptionDetailInFaults</code>, (either from <code>ServiceBehaviorAttribute</code> or from the configuration behavior), on the server in order to send the exception information back to the client, or turn on tracing as per the Microsoft .NET Framework 3.0 SDK documentation and inspect the server trace logs.

<h3>Avalara Calculation Error Result Codes:</h3>
ResultCode establishes the success or failure of a tax transaction, providing reasoning to the user as to why the tax calculation did or did not meet the expectation.
<ul class="dev-guide-list">
    <li><code>ResultCode = SeverityLevel.Success</code> - The transaction was successful, no known errors with the AvaTax calculation.</li>
    <li><code>ResultCode = SeverityLevel.Warning</code> - The only known circumstance under which ResultCode=Warning would be returned is for the API PostTax, when the TotalAmt or TotalTax fields do not agree with the amounts in the Avalara Database. In this case, the PostTax still completes.</li>
    <li><code>ResultCode = SeverityLevel.Error</code> - As shown above, this is a response generated by an error that has occurred in the API request or response from AvaTax.</li>
    <li><code>ResultCode = SeverityLevel.Exception</code> - Typically, Exception is only returned by a system error from the Avalara web service and will be caused by circumstances outside of the client applicationâ€™s control. For example an outage as discussed above.</li>
</ul>

Error messages give pertinent information as to the how, where and what has occurred within the failed API call.  Looking at the example below, let's say that John is a store owner.  John had a power outage and manually took an order for a customer late Friday afternoon.  On Monday he created and processed the order using AvaTax as usual.  However, John realized that he did not place the date of order on the invoice when the sale was made and wants to have the tax recalculated.  So he decides to recreate the same transaction with the same transaction number and calls the Avalara service.  He receives the error below.  Because this transaction already exists in the Avalara Admin Console, John cannot simply recreate the transaction in hopes it will override the one that exists.

<pre>
{
    "error": {
        "code": "GetTaxError",
        "message": "DocStatus is invalid for this operation.",
        "target": "Unknown",
        "details": [
            {
                "code": "GetTaxError",
                "number": 300,
                "message": "DocStatus is invalid for this operation.",
                "description": "Expected Saved|Posted",
                "faultCode": "GetTaxError",
                "helpLink": "http://developer.avalara.com/avatax/errors/GetTaxError",
                "refersTo": "DocStatus",
                "severity": "Error"
            }
        ]
    }
}
</pre>

<h3>Calculating Tax Offline Using TaxContent:</h3>
Our TaxContent tool builds a tax content file containing information useful for a retail point-of-sale (POS) solution. This file contains tax rates and rules for items and locations that can be used to correctly calculate tax in the event a POS device is not able to reach AvaTax. The data file can also be customized for specific partner devices and usage conditions.  

Let's take a look at an example of using a point of sale within a location defined in our Avalara Admin Console:
<div class="mobile-table">
    <table class="styled-table">
        <thead>
            <tr>
                <th>REQUEST: POST|https://sandbox-rest.avatax.com/api/v2/pointofsaledata/build</th>
            </tr>
        </thead>
        <tbody>
            <tr>
            <td>
              <pre>
{
  "companyCode":"DEFAULT"
  "documentDate":"2017-06-27T18:18:44.8781843Z"
  "responseType":"Json"
  "taxCodes":["P0000000"]
  "locationCodes":["01"]
  "includeJurisCodes":true
}
              </pre>
              </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="mobile-table">
    <table class="styled-table">
        <thead>
            <tr>
                <th>Response</th>
            </tr>
        </thead>
        <tbody>
            <tr>
            <td>
              <pre>
{
    "ShipToCity": "BAINBRIDGE ISLAND",
    "ShipToCounty": "KITSAP",
    "ShipToState": "WA",
    "ShipToPostalCode": "98110-2687",
    "ShipToCountry": "US",
    "JurisType": "State",
    "JurisCode": "53",
    "JurisName": "WASHINGTON",
    "TaxType": "Sales",
    "Tax_Description": "WA STATE TAX",
    "Tax_Rate": 0.065,
    "Cap": "0",
    "Threshold": "0",
    "TaxRuleOptions": "",
    "TaxApplicationLevel": ""
  },
[
    {
        "ScenarioId": 1,
        "EffDate": "11/1/2014 12:00:00 AM",
        "EndDate": "12/31/9999 12:00:00 AM",
        "LocationCode": "01",
        "TaxCode": "P0000000",
        "ShipToCity": "BAINBRIDGE ISLAND",
        "ShipToCounty": "KITSAP",
        "ShipToState": "WA",
        "ShipToPostalCode": "98110-2687",
        "ShipToCountry": "US",
        "JurisType": "State",
        "JurisCode": "53",
        "JurisName": "WASHINGTON",
        "TaxType": "Sales",
        "Tax_Description": "WA STATE TAX",
        "Tax_Rate": 0.065,
        "Cap": "0",
        "Threshold": "0",
        "TaxRuleOptions": "",
        "TaxApplicationLevel": ""
    },
    {
        "ScenarioId": 1,
        "EffDate": "11/1/2014 12:00:00 AM",
        "EndDate": "12/31/9999 12:00:00 AM",
        "LocationCode": "01",
        "TaxCode": "P0000000",
        "ShipToCity": "BAINBRIDGE ISLAND",
        "ShipToCounty": "KITSAP",
        "ShipToState": "WA",
        "ShipToPostalCode": "98110-2687",
        "ShipToCountry": "US",
        "JurisType": "County",
        "JurisCode": "035",
        "JurisName": "KITSAP",
        "TaxType": "Sales",
        "Tax_Description": "WA COUNTY TAX",
        "Tax_Rate": 0,
        "Cap": "0",
        "Threshold": "0",
        "TaxRuleOptions": "",
        "TaxApplicationLevel": ""
    },
    {
        "ScenarioId": 1,
        "EffDate": "4/1/2017 12:00:00 AM",
        "EndDate": "12/31/9999 12:00:00 AM",
        "LocationCode": "01",
        "TaxCode": "P0000000",
        "ShipToCity": "BAINBRIDGE ISLAND",
        "ShipToCounty": "KITSAP",
        "ShipToState": "WA",
        "ShipToPostalCode": "98110-2687",
        "ShipToCountry": "US",
        "JurisType": "City",
        "JurisCode": "03736",
        "JurisName": "BAINBRIDGE ISLAND",
        "TaxType": "Sales",
        "Tax_Description": "WA CITY TAX",
        "Tax_Rate": 0.025,
        "Cap": "0",
        "Threshold": "0",
        "TaxRuleOptions": "",
        "TaxApplicationLevel": ""
    }
]
              </pre>
              </td>
            </tr>
        </tbody>
    </table>
</div>

Calculating Tax Offline Using Rate Tables
If you just want to retrieve the tax rate for a given zip code, we've got you covered.  While zip code tax rates may not be as accurate (in fact, a zip code can have up to 20 different tax rates), the AvaTax API can produce rate tables by Zip Code OR by Street Address. Most free tax rate look-up tools only tell you the rate for a ZIP code, we do not charge for this functionality.

For information and to sign up for this free service, please visit our <a class="dev-guide-link" href="http://taxratesapi.avalara.com">website</a>:
<div class="mobile-table">
    <table class="styled-table">
        <thead>
            <tr>
                <th>GET | https://rest.avatax.com/api/v2/taxrates/byaddress</th>
            </tr>
        </thead>
        <tbody>
            <tr> 
            <td>
              <pre>
{
    "totalRate": 0.09,
    "rates": [
        {
            "rate": 0.065,
            "name": "WA STATE TAX",
            "type": "State"
        },
        {
            "rate": 0.025,
            "name": "WA CITY TAX",
            "type": "City"
        },
        {
            "rate": 0,
            "name": "WA COUNTY TAX",
            "type": "County"
        }
    ]
}
              </pre>
            </td>
            </tr>
        </tbody>
    </table>
</div>

<ul class="pager">
  <li class="previous"><a href="/avatax/dev-guide/calculating-tax-offline/"><i class="glyphicon glyphicon-chevron-left"></i>Previous</a></li>
  <li class="next"><a href="/avatax/dev-guide/calculating-tax-offline/performance-tuning-and-management/">Next<i class="glyphicon glyphicon-chevron-right"></i></a></li>
</ul>