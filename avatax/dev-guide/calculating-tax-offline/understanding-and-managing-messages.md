---
layout: page
title: 11.1 - Understanding and Managing Result/Error Messages
product: avaTax
doctype: dev_guide
chapter: calculating-tax-offline
nav: apis
disqus: 1
---

<ul class="pager">
  <li class="previous"><a href="/avatax/dev-guide/calculating-tax-offline/"><i class="glyphicon glyphicon-chevron-left"></i>Previous</a></li>
  <li class="previous"><a href="/avatax/dev-guide/calculating-tax-offline/chapter-summary/"><i class="glyphicon glyphicon-chevron-left"></i>Next</a></li>
</ul>

Understanding and taking appropriate action on error messages is critical to the successful implementation of a custom connector. The errors and warnings that result from web service calls will guide the receiver to the most logical problem resolution path.

If a call fails, the receiver should always iterate through the messages collection that will be part of the result set and check the contents of the Name, Summary, Details and RefersTo fields of each message. Often the contents of these messages will indicate what the problem is.

Let's breakdown an example error message.  John has processed a <code>SalesOrder</code> and is receiving an error message stating:  <code>DocumentNotFoundError: The tax document could not be found</code>.

The message may appear within the response xml data as the following:

While rare, consideration should be given to critical errors that can occur that are not as straight-forward.  For example, if encountering an error stating:  "The server was unable to process the request due to an internal error," the messaging provided may seem cryptic in the details of the error. To gain more information about the error, either turn on <code>IncludeExceptionDetailInFaults</code>, (either from <code>ServiceBehaviorAttribute</code> or from the configuration behavior), on the server in order to send the exception information back to the client, or turn on tracing as per the Microsoft .NET Framework 3.0 SDK documentation and inspect the server trace logs.

<h3>Avalara Calculation Error Result Codes:</h3>
ResultCode establishes the success or failure of a tax transaction, providing reasoning to the user as to why the tax calculation did or did not meet the expectation.
<ul class="dev-guide-list">
    <li>ResultCode = SeverityLevel.Success - The transaction was successful, no known errors with the AvaTax calculation.</li>
    <li><code>ResultCode = SeverityLevel.Warning</code> - The only known circumstance under which ResultCode=Warning would be returned is for the API PostTax, when the TotalAmt or TotalTax fields do not agree with the amounts in the Avalara Database. In this case, the PostTax still completes.</li>
    <li><code>ResultCode = SeverityLevel.Error</code> - As shown above, this is a response generated by an error that has occurred in the API request or response from AvaTax.</li>
    <li><code>ResultCode = SeverityLevel.Exception</code> - Typically, Exception is only returned by a system error from the Avalara web service and will be caused by circumstances outside of the client applicationâ€™s control. For example an outage as discussed above.</li>
</ul>

Error messages give pertinent information as to the how, where and what has occurred within the failed API call.  Looking at the example below, let's say that John is a store owner.  John had a power outage and manually took an order for a customer late Friday afternoon.  On Monday he created and processed the order using AvaTax as usual.  However, John realized that he did not place the date of order on the invoice when the sale was made and wants to have the tax recalculated.  So he decides to recreate the same transaction with the same transaction number and calls the Avalara service.  He receives the error below.  Because this transaction already exists in the Avalara Admin Console, John cannot simply recreate the transaction in hopes it will override the one that exists.

<pre>

{
    "error": {
        "code": "GetTaxError",
        "message": "DocStatus is invalid for this operation.",
        "target": "Unknown",
        "details": [
            {
                "code": "GetTaxError",
                "number": 300,
                "message": "DocStatus is invalid for this operation.",
                "description": "Expected Saved|Posted",
                "faultCode": "GetTaxError",
                "helpLink": "http://developer.avalara.com/avatax/errors/GetTaxError",
                "refersTo": "DocStatus",
                "severity": "Error"
            }
        ]
    }
</pre>

<h3>Calculating Tax Offline Using TaxContent:</h3>
-What is TaxContent-

Multilocation vs Single Location

<pre>
REQUEST:
 
 
{
  "companyCode": "STARLABS",
  "documentDate": "2017-07-28T18:18:44.8781843Z",
  "responseType": "Json",
    "taxCodes": [
        "P0000000"
    ],
  "locationCodes": [
    201
    
  ],
  "includeJurisCodes": true
}
 
 
RESPONSE:
 
 
[
    {
        "ScenarioId": 1,
        "EffDate": "11/1/2014 12:00:00 AM",
        "EndDate": "12/31/9999 12:00:00 AM",
        "LocationCode": "201",
        "TaxCode": "P0000000",
        "ShipToCity": "DURHAM",
        "ShipToCounty": "DURHAM",
        "ShipToState": "NC",
        "ShipToPostalCode": "27713-8261",
        "ShipToCountry": "US",
        "JurisType": "State",
        "JurisCode": "37",
        "JurisName": "NORTH CAROLINA",
        "TaxType": "Sales",
        "Tax_Description": "NC STATE TAX",
        "Tax_Rate": 0.0475,
        "Cap": "0",
        "Threshold": "0",
        "TaxRuleOptions": "",
        "TaxApplicationLevel": ""
    },
    {
        "ScenarioId": 1,
        "EffDate": "11/1/2014 12:00:00 AM",
        "EndDate": "12/31/9999 12:00:00 AM",
        "LocationCode": "201",
        "TaxCode": "P0000000",
        "ShipToCity": "DURHAM",
        "ShipToCounty": "DURHAM",
        "ShipToState": "NC",
        "ShipToPostalCode": "27713-8261",
        "ShipToCountry": "US",
        "JurisType": "County",
        "JurisCode": "063",
        "JurisName": "DURHAM",
        "TaxType": "Sales",
        "Tax_Description": "NC COUNTY TAX",
        "Tax_Rate": 0.0225,
        "Cap": "0",
        "Threshold": "0",
        "TaxRuleOptions": "",
        "TaxApplicationLevel": ""
    },
    {
        "ScenarioId": 1,
        "EffDate": "11/1/2014 12:00:00 AM",
        "EndDate": "12/31/9999 12:00:00 AM",
        "LocationCode": "201",
        "TaxCode": "P0000000",
        "ShipToCity": "DURHAM",
        "ShipToCounty": "DURHAM",
        "ShipToState": "NC",
        "ShipToPostalCode": "27713-8261",
        "ShipToCountry": "US",
        "JurisType": "Special",
        "JurisCode": "1237063001",
        "JurisName": "DURHAM CO TR",
        "TaxType": "Sales",
        "Tax_Description": "NC SPECIAL TAX",
        "Tax_Rate": 0.005,
        "Cap": "0",
        "Threshold": "0",
        "TaxRuleOptions": "",
        "TaxApplicationLevel": ""
    }
</pre>

Calculating Tax Offline Using Rate Tables

<pre>
{
    "totalRate": 0.075,
    "rates": [
        {
            "rate": 0.0475,
            "name": "NC STATE TAX",
            "type": "State"
        },
        {
            "rate": 0.0225,
            "name": "NC COUNTY TAX",
            "type": "County"
        },
        {
            "rate": 0.005,
            "name": "NC SPECIAL TAX",
            "type": "Special"
        }
    ]
}
</pre>

<h3>Performance Tuning</h3>

<ul class="dev-guide-list">
    <li>common problems: thinking AvaTax is down when it's just running slow</li>
    <li>Best practices for offline functionality
        <ul class="dev-guide-list">
            <li>Catch exceptions</li>
            <li>Retransmit</li>
            <li>Nightly reconciliation</li>
        </ul>
    </li>
    <li>Designing a Point of Sale system</li>
    <li><a class="dev-guide-link" href="https://developer.avalara.com/api-reference/avatax/rest/v2/methods/TaxContent/">TaxContent API</a></li>
</ul>

<ul class="pager">
  <li class="previous"><a href="/avatax/dev-guide/calculating-tax-offline/"><i class="glyphicon glyphicon-chevron-left"></i>Previous</a></li>
  <li class="previous"><a href="/avatax/dev-guide/calculating-tax-offline/chapter-summary/"><i class="glyphicon glyphicon-chevron-left"></i>Next</a></li>
</ul>